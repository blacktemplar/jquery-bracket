/* jQuery Bracket | Copyright (c) Teijo Laine 2011-2016 | Licenced under the MIT licence */
!function(a){function b(a){return!isNaN(parseFloat(a))&&isFinite(a)}function c(a){function b(a,c){return a instanceof Array?b(a[0],c+1):c}return b(a,0)}function d(a,b){return b>0&&(a=d([a],b-1)),a}function e(){return{source:null,name:"team-draw",id:-2,idx:-1,score:0}}function f(){return{source:null,name:null,id:-1,idx:-1,score:null}}function g(b){var c=0;return b.children().each(function(){c+=a(this).outerHeight(!0)}),c}function h(a){return b(a.a.score)&&b(a.b.score)?a.a.score>a.b.score?[a.a,a.b]:a.a.score<a.b.score?[a.b,a.a]:[e()]:[]}function i(a){return h(a)[0]||f()}function j(a){return h(a)[1]||f()}function k(b,c,d){var e=d.find(".team[data-teamid="+b+"]"),f=c?c:"highlight";return{highlight:function(){e.each(function(){a(this).addClass(f),a(this).hasClass("win")&&a(this).parent().find(".connector").addClass(f)})},deHighlight:function(){e.each(function(){a(this).removeClass(f),a(this).parent().find(".connector").removeClass(f)})}}}function l(b,c,d){var e=d||c,f=e.winner(),g=e.loser();f&&g&&(k(f.idx,"highlightWinner",b).highlight(),k(g.idx,"highlightLoser",b).highlight()),b.find(".team").mouseover(function(){var c=a(this).attr("data-teamid"),d=k(c,null,b);d.highlight(),a(this).mouseout(function(){d.deHighlight(),a(this).unbind("mouseout")})})}function m(b,c,d){var e=a('<input type="text">');e.val(c),b.html(e),e.focus(),e.blur(function(){d(e.val())}),e.keydown(function(a){var b=a.keyCode||a.which;9!==b&&13!==b&&27!==b||(a.preventDefault(),d(e.val(),27!==b))})}function n(a,b,c){a.append(b)}function o(a,b){}function p(a){var b=a.el,c=b.find(".team.win");c.append('<div class="bubble">1st</div>');var d=b.find(".team.lose");return d.append('<div class="bubble">2nd</div>'),!0}function q(a){var b=a.el,c=b.find(".team.win");c.append('<div class="bubble third">3rd</div>');var d=b.find(".team.lose");return d.append('<div class="bubble fourth">4th</div>'),!0}function r(a,b,c,d,e){for(var f,h=Math.log(2*b.length)/Math.log(2),i=b.length,j=0;h>j;j+=1){f=a.addRound();for(var k=0;i>k;k+=1){var l=0===j?y(b,k):null;if(j===h-1&&c||j===h-1&&e){var m=f.addMatch(l,p);e||m.setAlignCb(z(m,d))}else f.addMatch(l)}i/=2}if(c&&(a["final"]().connectorCb(function(){return null}),b.length>1&&!d)){var n=a["final"]().round().prev().match(0).loser,o=a["final"]().round().prev().match(1).loser,r=f.addMatch(function(){return[{source:n},{source:o}]},q);r.setAlignCb(function(b){var c=a.el.height()/2;r.el.css("height",c+"px");var d=g(b);b.css("top",d+"px")}),r.connectorCb(function(){return null})}}function s(a,b,c,d){for(var e=Math.log(2*c)/Math.log(2)-1,f=c/2,h=0;e>h;h+=1){for(var i=d&&h===e-1?1:2,j=0;i>j;j+=1)for(var k=b.addRound(),l=0;f>l;l+=1){var m=j%2!==0||0===h?A(a,b,f,l,j,h):null,n=h===e-1&&d,o=k.addMatch(m,n?q:null);if(o.setAlignCb(B(o.el.find(".teamContainer"),o)),n)o.connectorCb(function(){return null});else if(e-1>h||1>j){var p=j%2===0?function(a,b){var c=g(a)/4,d=0,e=0;return 0===b.winner().id?e=c:1===b.winner().id?(d=2*-c,e=c):e=2*c,{height:d,shift:e}}:null;o.connectorCb(p)}}f/=2}}function t(a,b,c,d,e,f,h){var i=a.addRound(),j=i.addMatch(function(){return[{source:b.winner},{source:c.winner}]},function(e){var i=!1;if(d||null===e.winner().name||e.winner().name!==c.winner().name)return p(e);if(2!==a.size()){var j=a.addRound(function(){var b=null!==e.winner().name&&e.winner().name===c.winner().name;return i===!1&&b&&(i=!0,f.css("width",parseInt(f.css("width"),10)+h+"px")),!b&&i&&(i=!1,a.dropRound(),f.css("width",parseInt(f.css("width"),10)-h+"px")),b}),k=j.addMatch(function(){return[{source:e.first},{source:e.second}]},p);return e.connectorCb(function(a){return{height:0,shift:g(a)/2}}),k.connectorCb(function(){return null}),k.setAlignCb(function(a){var d=b.el.height()+c.el.height();k.el.css("height",d+"px");var e=(b.el.height()/2+b.el.height()+c.el.height()/2)/2-g(a);a.css("top",e+"px")}),!1}});if(j.setAlignCb(function(a){var d=b.el.height()+c.el.height();e||(d/=2),j.el.css("height",d+"px");var f=(b.el.height()/2+b.el.height()+c.el.height()/2)/2-g(a);a.css("top",f+"px")}),!e){var k=c["final"]().round().prev().match(0).loser,l=i.addMatch(function(){return[{source:k},{source:c.loser}]},q);l.setAlignCb(function(a){var d=(b.el.height()+c.el.height())/2;l.el.css("height",d+"px");var e=(b.el.height()/2+b.el.height()+c.el.height()/2)/2+g(a)/2-d;a.css("top",e+"px")}),j.connectorCb(function(){return null}),l.connectorCb(function(){return null})}b["final"]().connectorCb(function(a){var d,e,f=g(a)/4,h=(b.el.height()/2+b.el.height()+c.el.height()/2)/2-g(a)/2,i=h-b.el.height()/2;return 0===b.winner().id?(e=i+2*f,d=f):1===b.winner().id?(e=i,d=3*f):(e=i+f,d=2*f),e-=g(a)/2,{height:e,shift:d}}),c["final"]().connectorCb(function(a){var d,e,f=g(a)/4,h=(b.el.height()/2+b.el.height()+c.el.height()/2)/2-g(a)/2,i=h-b.el.height()/2;return 0===c.winner().id?(e=i,d=3*f):1===c.winner().id?(e=i+2*f,d=f):(e=i+f,d=2*f),e+=g(a)/2,{height:-e,shift:-d}})}function u(b,c,d,e,f,g){var h=[],i=a('<div class="round"></div>');return{el:i,bracket:b,id:d,addMatch:function(a,c){var f=h.length,i=null!==a?a():[{source:b.round(d-1).match(2*f).winner},{source:b.round(d-1).match(2*f+1).winner}],j=g(this,i,f,e?e[f]:null,c);return h.push(j),j},match:function(a){return h[a]},prev:function(){return c},size:function(){return h.length},render:function(){i.empty(),("function"!=typeof f||f())&&(i.appendTo(b.el),a.each(h,function(a,b){b.render()}))},results:function(){var b=[];return a.each(h,function(a,c){b.push(c.results())}),b}}}function v(b,c,d){var e=[];return{el:b,addRound:function(a){var b=e.length,f=b>0?e[b-1]:null,g=u(this,f,b,c?c[b]:null,a,d);return e.push(g),g},dropRound:function(){e.pop()},round:function(a){return e[a]},size:function(){return e.length},"final":function(){return e[e.length-1].match(0)},winner:function(){return e[e.length-1].match(0).winner()},loser:function(){return e[e.length-1].match(0).loser()},render:function(){b.empty();for(var a=0;a<e.length;a+=1)e[a].render()},results:function(){var b=[];return a.each(e,function(a,c){b.push(c.results())}),b}}}function w(b,c,d,e){var f=parseInt(a(".round:first").css("margin-right"),10)/2,g=!0;0>b&&(g=!1,b=-b),2>b&&(b=0);var h=a('<div class="connector"></div>').appendTo(d);h.css("height",b),h.css("width",f+"px"),h.css(e,-f-2+"px"),c>=0?h.css("top",c+"px"):h.css("bottom",-c+"px"),g?h.css("border-bottom","none"):h.css("border-top","none");var i=a('<div class="connector"></div>').appendTo(h);return i.css("width",f+"px"),i.css(e,-f+"px"),g?i.css("bottom","0px"):i.css("top","0px"),h}function x(b,c,d){var e=a('<div class="tools"></div>').appendTo(b),f=a('<span class="increment">+</span>').appendTo(e);if(f.click(function(){for(var a=c.teams.length,b=0;a>b;b+=1)c.teams.push(["",""]);return C(d)}),c.teams.length>1&&1===c.results.length||c.teams.length>2&&3===c.results.length){var g=a('<span class="decrement">-</span>').appendTo(e);g.click(function(){return c.teams.length>1?(c.teams=c.teams.slice(0,c.teams.length/2),C(d)):void 0})}if(1===c.results.length&&c.teams.length>1){var h=a('<span class="doubleElimination">de</span>').appendTo(e);h.click(function(){return c.teams.length>1&&c.results.length<3?(c.results.push([],[]),C(d)):void 0})}else if(3===c.results.length&&c.teams.length>1){var h=a('<span class="singleElimination">se</span>').appendTo(e);h.click(function(){return 3===c.results.length?(c.results=c.results.slice(0,1),C(d)):void 0})}}var y=function(a,b){return function(){return[{source:function(){return{name:a[b][0],idx:2*b}}},{source:function(){return{name:a[b][1],idx:2*b+1}}}]}},z=function(a,b){return function(c){c.css("top",""),c.css("position","absolute"),b?c.css("top",a.el.height()/2-g(c)/2+"px"):c.css("bottom",-g(c)/2+"px")}},A=function(a,b,c,d,e,f){return function(){if(e%2===0&&0===f)return[{source:a.round(0).match(2*d).loser},{source:a.round(0).match(2*d+1).loser}];var g=f%2===0?c-d-1:d;return[{source:b.round(2*f).match(d).winner},{source:a.round(f+1).match(g).loser}]}},B=function(a,b){return function(){return a.css("top",b.el.height()/2-g(a)/2+"px")}},C=function(e){function f(a){p=0,y.render(),z&&z.render(),A&&!e.skipGrandFinalComeback&&A.render(),l(B,y,A),a&&(u.results[0]=y.results(),z&&(u.results[1]=z.results()),A&&!e.skipGrandFinalComeback&&(u.results[2]=A.results()),e.save&&e.save(u,e.userData))}function h(c,d,h,k,l){function m(c,d,g){var h=p,k=a('<div class="score" data-resultid="result-'+h+'"></div>'),l=d.name&&g&&b(d.score)?d.score:"--";k.append(l),p+=1;var m=d.name?d.name:"--",o=a('<div class="team"></div>'),q=a('<div class="label"></div>').appendTo(o);return 0===c&&o.attr("data-resultid","team-"+h),e.decorator.render(q,m,l),b(d.idx)&&o.attr("data-teamid",d.idx),null===d.name?o.addClass("na"):i(n).name===d.name?o.addClass("win"):j(n).name===d.name&&o.addClass("lose"),o.append(k),null!==d.name&&g&&e.save&&e.save&&(e.allowRenaming&&(q.addClass("editable"),q.click(function(){function b(){function h(h,i){h&&(e.init.teams[~~(d.idx/2)][d.idx%2]=h),f(!0),g.click(b);var j=e.el.find(".team[data-teamid="+(d.idx+1)+"] div.label:first");j.length&&i===!0&&0===c&&a(j).click()}g.unbind(),e.decorator.edit(g,d.name,h)}var g=a(this);b()})),d.name&&e.allowChangingScores&&(k.addClass("editable"),k.click(function(){function c(){e.unbind();var g=b(d.score)?e.text():"0",i=a('<input type="text">');i.val(g),e.html(i),i.focus().select(),i.keydown(function(c){b(a(this).val())?a(this).removeClass("error"):a(this).addClass("error");var d=c.keyCode||c.which;if(9===d||13===d||27===d){if(c.preventDefault(),a(this).blur(),27===d)return;var e=B.find("div.score[data-resultid=result-"+(h+1)+"]");e&&e.click()}}),i.blur(function(){var a=i.val();a&&b(a)||b(d.score)?a&&b(a)||!b(d.score)||(a=d.score):a="0",e.html(a),b(a)&&(d.score=parseInt(a,10),f(!0)),e.click(c)})}var e=a(this);c()}))),o}var n={a:d[0],b:d[1]},o=null,r=null,s=a('<div class="match"></div>'),t=a('<div class="teamContainer"></div>');if(!e.save){var u=k?k[2]:null;e.onMatchHover&&t.hover(function(){e.onMatchHover(u,!0)},function(){e.onMatchHover(u,!1)}),e.onMatchClick&&t.click(function(){e.onMatchClick(u)})}return n.a.id=0,n.b.id=1,n.a.name=n.a.source().name,n.b.name=n.b.source().name,n.a.score=k?k[0]:null,n.b.score=k?k[1]:null,n.a.name&&n.b.name||!b(n.a.score)&&!b(n.b.score)||console.log("ERROR IN SCORE DATA: "+n.a.source().name+": "+n.a.score+", "+n.b.source().name+": "+n.b.score),{el:s,id:h,round:function(){return c},connectorCb:function(a){o=a},connect:function(a){var b,c,d=g(t)/4,e=s.height()/2;if(a&&null!==a){var f=a(t,this);if(null===f)return;b=f.shift,c=f.height}else h%2===0?0===this.winner().id?(b=d,c=e):1===this.winner().id?(b=3*d,c=e-2*d):(b=2*d,c=e-d):0===this.winner().id?(b=3*-d,c=-e+2*d):1===this.winner().id?(b=-d,c=-e):(b=2*-d,c=-e+d);t.append(w(c,b,t,q))},winner:function(){return i(n)},loser:function(){return j(n)},first:function(){return n.a},second:function(){return n.b},setAlignCb:function(a){r=a},render:function(){s.empty(),t.empty(),n.a.name=n.a.source().name,n.b.name=n.b.source().name,n.a.idx=n.a.source().idx,n.b.idx=n.b.source().idx,i(n).name?t.removeClass("np"):t.addClass("np");var a=(Boolean(n.a.name)||""===n.a.name)&&(Boolean(n.b.name)||""===n.b.name);t.append(m(c.id,n.a,a)),t.append(m(c.id,n.b,a)),s.appendTo(c.el),s.append(t),this.el.css("height",c.bracket.el.height()/c.size()+"px"),t.css("top",this.el.height()/2-g(t)/2+"px"),null!==r&&r(t);var b="function"==typeof l?l(this):!1;b||this.connect(o);var d=k?k[2]:null;e.decorator.renderMatch(t,d)},results:function(){return[n.a.score,n.b.score]}}}function k(a){return D?Math.log(2*a)/Math.log(2):e.skipGrandFinalComeback?Math.max(2,2*(Math.log(2*a)/Math.log(2)-1)-1):2*(Math.log(2*a)/Math.log(2)-1)+1}var p,q="lr"===e.dir?"right":"left";if(!e)throw Error("Options not set");if(!e.el)throw Error("Invalid jQuery object as container");if(!e.init&&!e.save)throw Error("No bracket data or save callback given");void 0===e.userData&&(e.userData=null),e.decorator||(e.decorator={edit:m,render:n,renderMatch:o}),e.decorator.edit||(e.decorator.edit=m),e.decorator.render||(e.decorator.render=n),e.decorator.renderMatch||(e.decorator.renderMatch=o);var u;e.init||(e.init={teams:[["",""]],results:[]}),u=e.init;var y,z,A,B=a('<div class="jQBracket '+e.dir+'"></div>').appendTo(e.el.empty()),C=d(u.results,4-c(u.results));u.results=C;var D=C.length<=1;e.skipSecondaryFinal&&D&&a.error("skipSecondaryFinal setting is viable only in double elimination mode"),e.save&&e.allowResizing&&x(B,u,e);var E,F,G;D?F=a('<div class="bracket"></div>').appendTo(B):(e.skipGrandFinalComeback||(E=a('<div class="finals"></div>').appendTo(B)),F=a('<div class="bracket"></div>').appendTo(B),G=a('<div class="loserBracket"></div>').appendTo(B));var H=u.teams.length*e.teamHeight;F.css("height",H),D&&u.teams.length<=2&&!e.skipConsolationRound&&B.css("height",H+40),G&&G.css("height",F.height()/2);var I=k(u.teams.length);return e.save&&e.allowResizing?B.css("width",I*e.roundWidth+40):B.css("width",I*e.roundWidth+10),y=v(F,C&&C[0]?C[0]:null,h),D||(z=v(G,C&&C[1]?C[1]:null,h),e.skipGrandFinalComeback||(A=v(E,C&&C[2]?C[2]:null,h))),r(y,u.teams,D,e.skipConsolationRound,e.skipGrandFinalComeback&&!D),D||(s(y,z,u.teams.length,e.skipGrandFinalComeback),e.skipGrandFinalComeback||t(A,y,z,e.skipSecondaryFinal,e.skipConsolationRound,B,e.roundWidth)),f(!1),{data:function(){return e.init}}},D={init:function(b){var c=a.extend(!0,{},b),d=this;c.el=this,c.save&&(c.onMatchClick||c.onMatchHover)&&a.error("Match callbacks may not be passed in edit mode (in conjunction with save callback)"),c.roundWidth=c.roundWidth||100,c.teamHeight=c.teamHeight||64,c.roundWidth=parseInt(c.roundWidth,10)+40,c.dir=c.dir||"lr",c.init.teams=c.init.teams&&0!==c.init.teams.length?c.init.teams:[["",""]],c.skipConsolationRound=c.skipConsolationRound||!1,c.skipSecondaryFinal=c.skipSecondaryFinal||!1,c.allowRenaming=void 0===c.allowRenaming?!0:c.allowRenaming,c.allowResizing=void 0===c.allowResizing?!0:c.allowResizing,c.allowChangingScores=void 0===c.allowChangingScores?!0:c.allowChangingScores,"lr"!==c.dir&&"rl"!==c.dir&&a.error('Direction must be either: "lr" or "rl"');var e=C(c);return a(this).data("bracket",{target:d,obj:e}),e},data:function(){var b=a(this).data("bracket");return b.obj.data()}};a.fn.bracket=function(b){return D[b]?D[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.bracket"):D.init.apply(this,arguments)}}(jQuery);